{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/ondrejrehacek/Git/Stash/stash-pay-web/sample/app/api/checkout/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\nconst STASH_API_URL = 'https://test-api.stash.gg/sdk/server/checkout_links/generate_quick_pay_url';\nconst STASH_API_KEY = process.env.STASH_API_KEY;\n\nconst DEFAULT_PAYLOAD = {\n  regionCode: 'USA',\n  currency: 'USD',\n  item: {\n    id: '1d56f95f-28df-4ea5-9829-9671241f455e',\n    pricePerItem: '0.50',\n    quantity: 1,\n    imageUrl: 'https://upload.wikimedia.org/wikipedia/en/2/2d/Angry_Birds_promo_art.png',\n    name: 'Test Item',\n    description: 'This is a test purchase item',\n  },\n  user: {\n    id: '1d56f95f-28df-4ea5-9829-9671241f455e',\n    validatedEmail: 'test@rovio.com',\n    regionCode: 'US',\n    platform: 'IOS',\n  },\n};\n\nexport async function POST(request: NextRequest) {\n  const requestId = `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  console.log(`[${requestId}] POST /api/checkout - Request received`);\n  console.log(`[${requestId}] Environment check - STASH_API_KEY exists: ${!!STASH_API_KEY}`);\n  console.log(`[${requestId}] STASH_API_URL: ${STASH_API_URL}`);\n  \n  try {\n    console.log(`[${requestId}] Parsing request body...`);\n    const requestBody = await request.json().catch((parseError) => {\n      console.error(`[${requestId}] Failed to parse request body:`, parseError);\n      return {};\n    });\n    \n    console.log(`[${requestId}] Request body received:`, JSON.stringify(requestBody, null, 2));\n    \n    // Merge request body with default payload (request body takes precedence)\n    const payload = {\n      ...DEFAULT_PAYLOAD,\n      ...requestBody,\n      item: {\n        ...DEFAULT_PAYLOAD.item,\n        ...(requestBody.item || {}),\n      },\n      user: {\n        ...DEFAULT_PAYLOAD.user,\n        ...(requestBody.user || {}),\n      },\n    };\n\n    console.log(`[${requestId}] Final payload to send:`, JSON.stringify(payload, null, 2));\n    console.log(`[${requestId}] Making request to Stash API...`);\n\n    const fetchStartTime = Date.now();\n    const response = await fetch(STASH_API_URL, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-Stash-Api-Key': STASH_API_KEY || '',\n      },\n      body: JSON.stringify(payload),\n    });\n\n    const fetchDuration = Date.now() - fetchStartTime;\n    console.log(`[${requestId}] Stash API response received - Status: ${response.status} ${response.statusText}, Duration: ${fetchDuration}ms`);\n    console.log(`[${requestId}] Response headers:`, Object.fromEntries(response.headers.entries()));\n\n    if (!response.ok) {\n      console.error(`[${requestId}] Stash API returned error status: ${response.status}`);\n      const errorText = await response.text().catch(() => 'Failed to read error response');\n      console.error(`[${requestId}] Error response body:`, errorText);\n      \n      let errorData;\n      try {\n        errorData = JSON.parse(errorText);\n      } catch {\n        errorData = { raw: errorText };\n      }\n      \n      console.error(`[${requestId}] Parsed error data:`, JSON.stringify(errorData, null, 2));\n      \n      return NextResponse.json(\n        {\n          error: 'Failed to generate checkout link',\n          details: errorData,\n          requestId,\n        },\n        { status: response.status }\n      );\n    }\n\n    console.log(`[${requestId}] Parsing successful response...`);\n    const responseText = await response.text();\n    console.log(`[${requestId}] Raw response body:`, responseText);\n    \n    let data;\n    try {\n      data = JSON.parse(responseText);\n      console.log(`[${requestId}] Parsed response data:`, JSON.stringify(data, null, 2));\n    } catch (parseError) {\n      console.error(`[${requestId}] Failed to parse response JSON:`, parseError);\n      throw new Error(`Invalid JSON response from Stash API: ${parseError}`);\n    }\n    \n    console.log(`[${requestId}] Request completed successfully`);\n    return NextResponse.json(data);\n  } catch (error) {\n    console.error(`[${requestId}] Error generating checkout link:`, error);\n    console.error(`[${requestId}] Error type:`, error instanceof Error ? error.constructor.name : typeof error);\n    console.error(`[${requestId}] Error message:`, error instanceof Error ? error.message : String(error));\n    console.error(`[${requestId}] Error stack:`, error instanceof Error ? error.stack : 'No stack trace');\n    \n    return NextResponse.json(\n      {\n        error: 'Internal server error',\n        message: error instanceof Error ? error.message : 'Unknown error',\n        requestId,\n      },\n      { status: 500 }\n    );\n  }\n}\n\n"],"names":[],"mappings":"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"}}]
}